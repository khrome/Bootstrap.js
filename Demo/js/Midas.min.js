if(!Midas)var Midas={};Midas.SAXParser=new Class({initialize:function(){this.buildXMLcomponents();},buildXMLcomponents:function(){this.handler=new MidasSAXEventHandler();this.parser=new SAXDriver();},open:function(tagName,attributes){var node=document.id('widget_panel');var pro=attributes["d"];node.innerHTML=node.innerHTML+pro+"<br/><br/>";},content:function(text){},close:function(tagName){},error:function(exception){throw('SAX Parse Error('+exception.m_strErrMsg+')');},parse:function(xml){if(!this.handler)this.buildXMLcomponents();this.handler.startTag=this.open.bind(this);this.handler.createError=this.error.bind(this);this.handler.endTag=this.close.bind(this);this.handler.charData=this.content.bind(this);this.parser.setDocumentHandler(this.handler);this.parser.setLexicalHandler(this.handler);this.parser.setErrorHandler(this.handler);this.parser.parse(xml);}});MidasSAXEventHandler=function(){this.characterData="";};MidasSAXEventHandler.prototype.startTag=function(name,attrs){};MidasSAXEventHandler.prototype.charData=function(chars){};MidasSAXEventHandler.prototype.endTag=function(name){};MidasSAXEventHandler.prototype.characters=function(data,start,length){this.characterData+=data.substr(start,length);}
MidasSAXEventHandler.prototype.endDocument=function(){this._handleCharacterData();}
MidasSAXEventHandler.prototype.endElement=function(name){this._handleCharacterData();this.endTag(name);}
MidasSAXEventHandler.prototype.processingInstruction=function(target,data){this._handleCharacterData();}
MidasSAXEventHandler.prototype.setDocumentLocator=function(locator){this._handleCharacterData();}
MidasSAXEventHandler.prototype.startElement=function(name,atts){this._handleCharacterData();var attrs={};for(var lcv=0;lcv<atts.getLength();lcv++){attrs[atts.getName(lcv)]=atts.getValue(lcv);}
this.startTag(name,attrs);}
MidasSAXEventHandler.prototype.startDocument=function(){this._handleCharacterData();}
MidasSAXEventHandler.prototype.comment=function(data,start,length){this._handleCharacterData();}
MidasSAXEventHandler.prototype.endCDATA=function(){this._handleCharacterData();}
MidasSAXEventHandler.prototype.startCDATA=function(){this._handleCharacterData();}
MidasSAXEventHandler.prototype.error=function(exception){this._handleCharacterData();this.createError(exception);}
MidasSAXEventHandler.prototype.fatalError=function(exception){this._handleCharacterData();this.createError(exception);}
MidasSAXEventHandler.prototype.warning=function(exception){this._handleCharacterData();}
MidasSAXEventHandler.prototype._fullCharacterDataReceived=function(fullCharacterData){this.charData(fullCharacterData);}
MidasSAXEventHandler.prototype._handleCharacterData=function(){if(this.characterData!=""){this._fullCharacterDataReceived(this.characterData);}
this.characterData="";}
var whitespace="\n\r\t ";XMLP=function(strXML){strXML=SAXStrings.replace(strXML,null,null,"\r\n","\n");strXML=SAXStrings.replace(strXML,null,null,"\r","\n");this.m_xml=strXML;this.m_iP=0;this.m_iState=XMLP._STATE_PROLOG;this.m_stack=new Stack();this._clearAttributes();}
XMLP._NONE=0;XMLP._ELM_B=1;XMLP._ELM_E=2;XMLP._ELM_EMP=3;XMLP._ATT=4;XMLP._TEXT=5;XMLP._ENTITY=6;XMLP._PI=7;XMLP._CDATA=8;XMLP._COMMENT=9;XMLP._DTD=10;XMLP._ERROR=11;XMLP._CONT_XML=0;XMLP._CONT_ALT=1;XMLP._ATT_NAME=0;XMLP._ATT_VAL=1;XMLP._STATE_PROLOG=1;XMLP._STATE_DOCUMENT=2;XMLP._STATE_MISC=3;XMLP._errs=new Array();XMLP._errs[XMLP.ERR_CLOSE_PI=0]="PI: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_DTD=1]="DTD: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_COMMENT=2]="Comment: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_CDATA=3]="CDATA: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ELM=4]="Element: missing closing sequence";XMLP._errs[XMLP.ERR_CLOSE_ENTITY=5]="Entity: missing closing sequence";XMLP._errs[XMLP.ERR_PI_TARGET=6]="PI: target is required";XMLP._errs[XMLP.ERR_ELM_EMPTY=7]="Element: cannot be both empty and closing";XMLP._errs[XMLP.ERR_ELM_NAME=8]="Element: name must immediatly follow \"<\"";XMLP._errs[XMLP.ERR_ELM_LT_NAME=9]="Element: \"<\" not allowed in element names";XMLP._errs[XMLP.ERR_ATT_VALUES=10]="Attribute: values are required and must be in quotes";XMLP._errs[XMLP.ERR_ATT_LT_NAME=11]="Element: \"<\" not allowed in attribute names";XMLP._errs[XMLP.ERR_ATT_LT_VALUE=12]="Attribute: \"<\" not allowed in attribute values";XMLP._errs[XMLP.ERR_ATT_DUP=13]="Attribute: duplicate attributes not allowed";XMLP._errs[XMLP.ERR_ENTITY_UNKNOWN=14]="Entity: unknown entity";XMLP._errs[XMLP.ERR_INFINITELOOP=15]="Infininte loop";XMLP._errs[XMLP.ERR_DOC_STRUCTURE=16]="Document: only comments, processing instructions, or whitespace allowed outside of document element";XMLP._errs[XMLP.ERR_ELM_NESTING=17]="Element: must be nested correctly";XMLP.prototype._addAttribute=function(name,value){this.m_atts[this.m_atts.length]=new Array(name,value);}
XMLP.prototype._checkStructure=function(iEvent){if(XMLP._STATE_PROLOG==this.m_iState){if((XMLP._TEXT==iEvent)||(XMLP._ENTITY==iEvent)){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE);}}
if((XMLP._ELM_B==iEvent)||(XMLP._ELM_EMP==iEvent)){this.m_iState=XMLP._STATE_DOCUMENT;}}
if(XMLP._STATE_DOCUMENT==this.m_iState){if((XMLP._ELM_B==iEvent)||(XMLP._ELM_EMP==iEvent)){this.m_stack.push(this.getName());}
if((XMLP._ELM_E==iEvent)||(XMLP._ELM_EMP==iEvent)){var strTop=this.m_stack.pop();if((strTop==null)||(strTop!=this.getName())){return this._setErr(XMLP.ERR_ELM_NESTING);}}
if(this.m_stack.count()==0){this.m_iState=XMLP._STATE_MISC;return iEvent;}}
if(XMLP._STATE_MISC==this.m_iState){if((XMLP._ELM_B==iEvent)||(XMLP._ELM_E==iEvent)||(XMLP._ELM_EMP==iEvent)||(XMLP.EVT_DTD==iEvent)){return this._setErr(XMLP.ERR_DOC_STRUCTURE);}
if((XMLP._TEXT==iEvent)||(XMLP._ENTITY==iEvent)){if(SAXStrings.indexOfNonWhitespace(this.getContent(),this.getContentBegin(),this.getContentEnd())!=-1){return this._setErr(XMLP.ERR_DOC_STRUCTURE);}}}
return iEvent;}
XMLP.prototype._clearAttributes=function(){this.m_atts=new Array();}
XMLP.prototype._findAttributeIndex=function(name){for(var i=0;i<this.m_atts.length;i++){if(this.m_atts[i][XMLP._ATT_NAME]==name){return i;}}
return-1;}
XMLP.prototype.getAttributeCount=function(){return this.m_atts?this.m_atts.length:0;}
XMLP.prototype.getAttributeName=function(index){return((index<0)||(index>=this.m_atts.length))?null:this.m_atts[index][XMLP._ATT_NAME];}
XMLP.prototype.getAttributeValue=function(index){return((index<0)||(index>=this.m_atts.length))?null:__unescapeString(this.m_atts[index][XMLP._ATT_VAL]);}
XMLP.prototype.getAttributeValueByName=function(name){return this.getAttributeValue(this._findAttributeIndex(name));}
XMLP.prototype.getColumnNumber=function(){return SAXStrings.getColumnNumber(this.m_xml,this.m_iP);}
XMLP.prototype.getContent=function(){return(this.m_cSrc==XMLP._CONT_XML)?this.m_xml:this.m_cAlt;}
XMLP.prototype.getContentBegin=function(){return this.m_cB;}
XMLP.prototype.getContentEnd=function(){return this.m_cE;}
XMLP.prototype.getLineNumber=function(){return SAXStrings.getLineNumber(this.m_xml,this.m_iP);}
XMLP.prototype.getName=function(){return this.m_name;}
XMLP.prototype.next=function(){return this._checkStructure(this._parse());}
XMLP.prototype._parse=function(){if(this.m_iP==this.m_xml.length){return XMLP._NONE;}
if(this.m_iP==this.m_xml.indexOf("<?",this.m_iP)){return this._parsePI(this.m_iP+2);}
else if(this.m_iP==this.m_xml.indexOf("<!DOCTYPE",this.m_iP)){return this._parseDTD(this.m_iP+9);}
else if(this.m_iP==this.m_xml.indexOf("<!--",this.m_iP)){return this._parseComment(this.m_iP+4);}
else if(this.m_iP==this.m_xml.indexOf("<![CDATA[",this.m_iP)){return this._parseCDATA(this.m_iP+9);}
else if(this.m_iP==this.m_xml.indexOf("<",this.m_iP)){return this._parseElement(this.m_iP+1);}
else if(this.m_iP==this.m_xml.indexOf("&",this.m_iP)){return this._parseEntity(this.m_iP+1);}
else{return this._parseText(this.m_iP);}}
XMLP.prototype._parseAttribute=function(iB,iE){var iNB,iNE,iEq,iVB,iVE;var cQuote,strN,strV;this.m_cAlt="";iNB=SAXStrings.indexOfNonWhitespace(this.m_xml,iB,iE);if((iNB==-1)||(iNB>=iE)){return iNB;}
iEq=this.m_xml.indexOf("=",iNB);if((iEq==-1)||(iEq>iE)){return this._setErr(XMLP.ERR_ATT_VALUES);}
iNE=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,iNB,iEq);iVB=SAXStrings.indexOfNonWhitespace(this.m_xml,iEq+1,iE);if((iVB==-1)||(iVB>iE)){return this._setErr(XMLP.ERR_ATT_VALUES);}
cQuote=this.m_xml.charAt(iVB);if(SAXStrings.QUOTES.indexOf(cQuote)==-1){return this._setErr(XMLP.ERR_ATT_VALUES);}
iVE=this.m_xml.indexOf(cQuote,iVB+1);if((iVE==-1)||(iVE>iE)){return this._setErr(XMLP.ERR_ATT_VALUES);}
strN=this.m_xml.substring(iNB,iNE+1);strV=this.m_xml.substring(iVB+1,iVE);if(strN.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_NAME);}
if(strV.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ATT_LT_VALUE);}
strV=SAXStrings.replace(strV,null,null,"\n"," ");strV=SAXStrings.replace(strV,null,null,"\t"," ");iRet=this._replaceEntities(strV);if(iRet==XMLP._ERROR){return iRet;}
strV=this.m_cAlt;if(this._findAttributeIndex(strN)==-1){this._addAttribute(strN,strV);}
else{return this._setErr(XMLP.ERR_ATT_DUP);}
this.m_iP=iVE+2;return XMLP._ATT;}
XMLP.prototype._parseCDATA=function(iB){var iE=this.m_xml.indexOf("]]>",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_CDATA);}
this._setContent(XMLP._CONT_XML,iB,iE);this.m_iP=iE+3;return XMLP._CDATA;}
XMLP.prototype._parseComment=function(iB){var iE=this.m_xml.indexOf("-"+"->",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_COMMENT);}
this._setContent(XMLP._CONT_XML,iB,iE);this.m_iP=iE+3;return XMLP._COMMENT;}
XMLP.prototype._parseDTD=function(iB){var iE,strClose,iInt,iLast;iE=this.m_xml.indexOf(">",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_DTD);}
iInt=this.m_xml.indexOf("[",iB);strClose=((iInt!=-1)&&(iInt<iE))?"]>":">";while(true){if(iE==iLast){return this._setErr(XMLP.ERR_INFINITELOOP);}
iLast=iE;iE=this.m_xml.indexOf(strClose,iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_DTD);}
if(this.m_xml.substring(iE-1,iE+2)!="]]>"){break;}}
this.m_iP=iE+strClose.length;return XMLP._DTD;}
XMLP.prototype._parseElement=function(iB){var iE,iDE,iNE,iRet;var iType,strN,iLast;iDE=iE=this.m_xml.indexOf(">",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_ELM);}
if(this.m_xml.charAt(iB)=="/"){iType=XMLP._ELM_E;iB++;}else{iType=XMLP._ELM_B;}
if(this.m_xml.charAt(iE-1)=="/"){if(iType==XMLP._ELM_E){return this._setErr(XMLP.ERR_ELM_EMPTY);}
iType=XMLP._ELM_EMP;iDE--;}
iDE=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,iB,iDE);if(iE-iB!=1){if(SAXStrings.indexOfNonWhitespace(this.m_xml,iB,iDE)!=iB){return this._setErr(XMLP.ERR_ELM_NAME);}}
this._clearAttributes();iNE=SAXStrings.indexOfWhitespace(this.m_xml,iB,iDE);if(iNE==-1){iNE=iDE+1;}
else{this.m_iP=iNE;while(this.m_iP<iDE){if(this.m_iP==iLast)return this._setErr(XMLP.ERR_INFINITELOOP);iLast=this.m_iP;iRet=this._parseAttribute(this.m_iP,iDE);if(iRet==XMLP._ERROR)return iRet;}}
strN=this.m_xml.substring(iB,iNE);if(strN.indexOf("<")!=-1){return this._setErr(XMLP.ERR_ELM_LT_NAME);}
this.m_name=strN;this.m_iP=iE+1;return iType;}
XMLP.prototype._parseEntity=function(iB){var iE=this.m_xml.indexOf(";",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_ENTITY);}
this.m_iP=iE+1;return this._replaceEntity(this.m_xml,iB,iE);}
XMLP.prototype._parsePI=function(iB){var iE,iTB,iTE,iCB,iCE;iE=this.m_xml.indexOf("?>",iB);if(iE==-1){return this._setErr(XMLP.ERR_CLOSE_PI);}
iTB=SAXStrings.indexOfNonWhitespace(this.m_xml,iB,iE);if(iTB==-1){return this._setErr(XMLP.ERR_PI_TARGET);}
iTE=SAXStrings.indexOfWhitespace(this.m_xml,iTB,iE);if(iTE==-1){iTE=iE;}
iCB=SAXStrings.indexOfNonWhitespace(this.m_xml,iTE,iE);if(iCB==-1){iCB=iE;}
iCE=SAXStrings.lastIndexOfNonWhitespace(this.m_xml,iCB,iE);if(iCE==-1){iCE=iE-1;}
this.m_name=this.m_xml.substring(iTB,iTE);this._setContent(XMLP._CONT_XML,iCB,iCE+1);this.m_iP=iE+2;return XMLP._PI;}
XMLP.prototype._parseText=function(iB){var iE,iEE;iE=this.m_xml.indexOf("<",iB);if(iE==-1){iE=this.m_xml.length;}
iEE=this.m_xml.indexOf("&",iB);if((iEE!=-1)&&(iEE<=iE)){iE=iEE;}
this._setContent(XMLP._CONT_XML,iB,iE);this.m_iP=iE;return XMLP._TEXT;}
XMLP.prototype._replaceEntities=function(strD,iB,iE){if(SAXStrings.isEmpty(strD))return"";iB=iB||0;iE=iE||strD.length;var iEB,iEE,strRet="";iEB=strD.indexOf("&",iB);iEE=iB;while((iEB>0)&&(iEB<iE)){strRet+=strD.substring(iEE,iEB);iEE=strD.indexOf(";",iEB)+1;if((iEE==0)||(iEE>iE)){return this._setErr(XMLP.ERR_CLOSE_ENTITY);}
iRet=this._replaceEntity(strD,iEB+1,iEE-1);if(iRet==XMLP._ERROR){return iRet;}
strRet+=this.m_cAlt;iEB=strD.indexOf("&",iEE);}
if(iEE!=iE){strRet+=strD.substring(iEE,iE);}
this._setContent(XMLP._CONT_ALT,strRet);return XMLP._ENTITY;}
XMLP.prototype._replaceEntity=function(strD,iB,iE){if(SAXStrings.isEmpty(strD))return-1;iB=iB||0;iE=iE||strD.length;switch(strD.substring(iB,iE)){case"amp":strEnt="&";break;case"lt":strEnt="<";break;case"gt":strEnt=">";break;case"apos":strEnt="'";break;case"quot":strEnt="\"";break;default:if(strD.charAt(iB)=="#"){strEnt=String.fromCharCode(parseInt(strD.substring(iB+1,iE)));}else{return this._setErr(XMLP.ERR_ENTITY_UNKNOWN);}
break;}
this._setContent(XMLP._CONT_ALT,strEnt);return XMLP._ENTITY;}
XMLP.prototype._setContent=function(iSrc){var args=arguments;if(XMLP._CONT_XML==iSrc){this.m_cAlt=null;this.m_cB=args[1];this.m_cE=args[2];}else{this.m_cAlt=args[1];this.m_cB=0;this.m_cE=args[1].length;}
this.m_cSrc=iSrc;}
XMLP.prototype._setErr=function(iErr){var strErr=XMLP._errs[iErr];this.m_cAlt=strErr;this.m_cB=0;this.m_cE=strErr.length;this.m_cSrc=XMLP._CONT_ALT;return XMLP._ERROR;}
SAXDriver=function(){this.m_hndDoc=null;this.m_hndErr=null;this.m_hndLex=null;}
SAXDriver.DOC_B=1;SAXDriver.DOC_E=2;SAXDriver.ELM_B=3;SAXDriver.ELM_E=4;SAXDriver.CHARS=5;SAXDriver.PI=6;SAXDriver.CD_B=7;SAXDriver.CD_E=8;SAXDriver.CMNT=9;SAXDriver.DTD_B=10;SAXDriver.DTD_E=11;SAXDriver.prototype.parse=function(strD){var parser=new XMLP(strD);if(this.m_hndDoc&&this.m_hndDoc.setDocumentLocator){this.m_hndDoc.setDocumentLocator(this);}
this.m_parser=parser;this.m_bErr=false;if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_B);}
this._parseLoop();if(!this.m_bErr){this._fireEvent(SAXDriver.DOC_E);}
this.m_xml=null;this.m_iP=0;}
SAXDriver.prototype.setDocumentHandler=function(hnd){this.m_hndDoc=hnd;}
SAXDriver.prototype.setErrorHandler=function(hnd){this.m_hndErr=hnd;}
SAXDriver.prototype.setLexicalHandler=function(hnd){this.m_hndLex=hnd;}
SAXDriver.prototype.getColumnNumber=function(){return this.m_parser.getColumnNumber();}
SAXDriver.prototype.getLineNumber=function(){return this.m_parser.getLineNumber();}
SAXDriver.prototype.getMessage=function(){return this.m_strErrMsg;}
SAXDriver.prototype.getPublicId=function(){return null;}
SAXDriver.prototype.getSystemId=function(){return null;}
SAXDriver.prototype.getLength=function(){return this.m_parser.getAttributeCount();}
SAXDriver.prototype.getName=function(index){return this.m_parser.getAttributeName(index);}
SAXDriver.prototype.getValue=function(index){return this.m_parser.getAttributeValue(index);}
SAXDriver.prototype.getValueByName=function(name){return this.m_parser.getAttributeValueByName(name);}
SAXDriver.prototype._fireError=function(strMsg){this.m_strErrMsg=strMsg;this.m_bErr=true;if(this.m_hndErr&&this.m_hndErr.fatalError){this.m_hndErr.fatalError(this);}}
SAXDriver.prototype._fireEvent=function(iEvt){var hnd,func,args=arguments,iLen=args.length-1;if(this.m_bErr)return;if(SAXDriver.DOC_B==iEvt){func="startDocument";hnd=this.m_hndDoc;}
else if(SAXDriver.DOC_E==iEvt){func="endDocument";hnd=this.m_hndDoc;}
else if(SAXDriver.ELM_B==iEvt){func="startElement";hnd=this.m_hndDoc;}
else if(SAXDriver.ELM_E==iEvt){func="endElement";hnd=this.m_hndDoc;}
else if(SAXDriver.CHARS==iEvt){func="characters";hnd=this.m_hndDoc;}
else if(SAXDriver.PI==iEvt){func="processingInstruction";hnd=this.m_hndDoc;}
else if(SAXDriver.CD_B==iEvt){func="startCDATA";hnd=this.m_hndLex;}
else if(SAXDriver.CD_E==iEvt){func="endCDATA";hnd=this.m_hndLex;}
else if(SAXDriver.CMNT==iEvt){func="comment";hnd=this.m_hndLex;}
if(hnd&&hnd[func]){if(0==iLen){hnd[func]();}
else if(1==iLen){hnd[func](args[1]);}
else if(2==iLen){hnd[func](args[1],args[2]);}
else if(3==iLen){hnd[func](args[1],args[2],args[3]);}}}
SAXDriver.prototype._parseLoop=function(parser){var iEvent,parser;parser=this.m_parser;while(!this.m_bErr){iEvent=parser.next();if(iEvent==XMLP._ELM_B){this._fireEvent(SAXDriver.ELM_B,parser.getName(),this);}
else if(iEvent==XMLP._ELM_E){this._fireEvent(SAXDriver.ELM_E,parser.getName());}
else if(iEvent==XMLP._ELM_EMP){this._fireEvent(SAXDriver.ELM_B,parser.getName(),this);this._fireEvent(SAXDriver.ELM_E,parser.getName());}
else if(iEvent==XMLP._TEXT){this._fireEvent(SAXDriver.CHARS,parser.getContent(),parser.getContentBegin(),parser.getContentEnd()-parser.getContentBegin());}
else if(iEvent==XMLP._ENTITY){this._fireEvent(SAXDriver.CHARS,parser.getContent(),parser.getContentBegin(),parser.getContentEnd()-parser.getContentBegin());}
else if(iEvent==XMLP._PI){this._fireEvent(SAXDriver.PI,parser.getName(),parser.getContent().substring(parser.getContentBegin(),parser.getContentEnd()));}
else if(iEvent==XMLP._CDATA){this._fireEvent(SAXDriver.CD_B);this._fireEvent(SAXDriver.CHARS,parser.getContent(),parser.getContentBegin(),parser.getContentEnd()-parser.getContentBegin());this._fireEvent(SAXDriver.CD_E);}
else if(iEvent==XMLP._COMMENT){this._fireEvent(SAXDriver.CMNT,parser.getContent(),parser.getContentBegin(),parser.getContentEnd()-parser.getContentBegin());}
else if(iEvent==XMLP._DTD){}
else if(iEvent==XMLP._ERROR){this._fireError(parser.getContent());}
else if(iEvent==XMLP._NONE){return;}}}
SAXStrings=function(){}
SAXStrings.WHITESPACE=" \t\n\r";SAXStrings.QUOTES="\"'";SAXStrings.getColumnNumber=function(strD,iP){if(SAXStrings.isEmpty(strD)){return-1;}
iP=iP||strD.length;var arrD=strD.substring(0,iP).split("\n");var strLine=arrD[arrD.length-1];arrD.length--;var iLinePos=arrD.join("\n").length;return iP-iLinePos;}
SAXStrings.getLineNumber=function(strD,iP){if(SAXStrings.isEmpty(strD)){return-1;}
iP=iP||strD.length;return strD.substring(0,iP).split("\n").length}
SAXStrings.indexOfNonWhitespace=function(strD,iB,iE){if(SAXStrings.isEmpty(strD)){return-1;}
iB=iB||0;iE=iE||strD.length;for(var i=iB;i<iE;i++){if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i))==-1){return i;}}
return-1;}
SAXStrings.indexOfWhitespace=function(strD,iB,iE){if(SAXStrings.isEmpty(strD)){return-1;}
iB=iB||0;iE=iE||strD.length;for(var i=iB;i<iE;i++){if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i))!=-1){return i;}}
return-1;}
SAXStrings.isEmpty=function(strD){return(strD==null)||(strD.length==0);}
SAXStrings.lastIndexOfNonWhitespace=function(strD,iB,iE){if(SAXStrings.isEmpty(strD)){return-1;}
iB=iB||0;iE=iE||strD.length;for(var i=iE-1;i>=iB;i--){if(SAXStrings.WHITESPACE.indexOf(strD.charAt(i))==-1){return i;}}
return-1;}
SAXStrings.replace=function(strD,iB,iE,strF,strR){if(SAXStrings.isEmpty(strD)){return"";}
iB=iB||0;iE=iE||strD.length;return strD.substring(iB,iE).split(strF).join(strR);}
Stack=function(){this.m_arr=new Array();}
Stack.prototype.clear=function(){this.m_arr=new Array();}
Stack.prototype.count=function(){return this.m_arr.length;}
Stack.prototype.destroy=function(){this.m_arr=null;}
Stack.prototype.peek=function(){if(this.m_arr.length==0){return null;}
return this.m_arr[this.m_arr.length-1];}
Stack.prototype.pop=function(){if(this.m_arr.length==0){return null;}
var o=this.m_arr[this.m_arr.length-1];this.m_arr.length--;return o;}
Stack.prototype.push=function(o){this.m_arr[this.m_arr.length]=o;}
function isEmpty(str){return(str==null)||(str.length==0);}
function trim(trimString,leftTrim,rightTrim){if(isEmpty(trimString)){return"";}
if(leftTrim==null){leftTrim=true;}
if(rightTrim==null){rightTrim=true;}
var left=0;var right=0;var i=0;var k=0;if(leftTrim==true){while((i<trimString.length)&&(whitespace.indexOf(trimString.charAt(i++))!=-1)){left++;}}
if(rightTrim==true){k=trimString.length-1;while((k>=left)&&(whitespace.indexOf(trimString.charAt(k--))!=-1)){right++;}}
return trimString.substring(left,trimString.length-right);}
function __escapeString(str){var escAmpRegEx=/&/g;var escLtRegEx=/</g;var escGtRegEx=/>/g;var quotRegEx=/"/g;var aposRegEx=/'/g;str=str.replace(escAmpRegEx,"&amp;");str=str.replace(escLtRegEx,"&lt;");str=str.replace(escGtRegEx,"&gt;");str=str.replace(quotRegEx,"&quot;");str=str.replace(aposRegEx,"&apos;");return str;}
function __unescapeString(str){var escAmpRegEx=/&amp;/g;var escLtRegEx=/&lt;/g;var escGtRegEx=/&gt;/g;var quotRegEx=/&quot;/g;var aposRegEx=/&apos;/g;str=str.replace(escAmpRegEx,"&");str=str.replace(escLtRegEx,"<");str=str.replace(escGtRegEx,">");str=str.replace(quotRegEx,"\"");str=str.replace(aposRegEx,"'");return str;};if(!Midas)var Midas={};Midas.INIParser=new Class({parse:function(text){var inQuote=false;var inComment=false;var isAssigning=false;var inGrouping=false;var buffer='';var label='';var group=null;var currentQuoteType='';var results={};var ch;for(var lcv=0;lcv<text.length;lcv++){ch=text[lcv];if(buffer==''&&ch=='['){inGrouping=true;}
if(inGrouping){if(ch==']'){group=buffer;buffer='';inGrouping=false;}else if(ch!='[')buffer+=ch;continue;}
if(inComment){if(ch=="\n"){inComment=false;if(isAssigning){if(group==null){if(label!='')results[label]=buffer;}else{if(!results[group])results[group]={};if(label!='')results[group][label]=buffer;}
label=buffer='';}}else continue;}
if(!inQuote&&!inComment){if(ch==';'){inComment=true;continue;}
if(ch=='\''||ch=='"'){inQuote=true;currentQuoteType=ch;continue;}
if(!isAssigning&&ch=='='){label=buffer;buffer='';isAssigning=true;}else{if(ch=="\n"){isAssigning=false;if(group==null){if(label!='')results[label]=buffer;}else{if(!results[group])results[group]={};if(label!='')results[group][label]=buffer;}
label=buffer='';}else{if(ch!=' ')buffer+=ch;}}}else{if(inQuote){if(ch==currentQuoteType){inQuote=false;}else{buffer+=ch;}}}}
if(group==null){if(label!='')results[label]=buffer;}else{if(!results[group])results[group]={};if(label!='')results[group][label]=buffer;}
return results;}});;if(!Midas)var Midas={};Midas.Properties=new Class({values:{},parser:null,initialize:function(filename,callback){if(filename){new Request({url:filename,onSuccess:function(data){this.load(data);if(callback)callback();}.bind(this)}).send();}
this.parser=new Midas.PropertiesParser();},set:function(label,value){this.values[label]=value;},get:function(label){return this.values[label];},load:function(data){this.values=this.parser.parse(data);},write:function(){result='';for(label in this.values){result+=label+' = '+this.values[label]+"\n";}
return result;}});Midas.PropertiesParser=new Class({parse:function(fileBody){var lines=fileBody.split("\n");var pos,predicate,unicodeMatches;var properties={};var multi=false;var last=null;lines.each(function(line){if(line.trim().substring(0,1)=='#'||line.trim().substring(0,1)=='!')return;if(multi&&last!=null){if(line.substring(line.length-1)!='\\'){properties[last]=properties[last]+line.trim();multi=false;}else{properties[last]=properties[last]+line.trim().substring(0,line.length-1);}
return;}
pos=line.indexOf("=");if(pos==-1)pos=line.indexOf(":");if(pos!=-1){last=line.substring(0,pos).trim().replace(/\\ /g,' ');predicate=line.substring(pos+1).trim();unicodeMatches=predicate.match(/\\u[0-9]{4}/g);if(unicodeMatches)unicodeMatches.each(function(match){var character=eval('"'+match+'"');var rx=new RegExp(match.replace('\\','\\\\'),'g');predicate=predicate.replace(rx,character);});if(line.substring(line.length-1)=='\\'){predicate=line.substring(pos+1).trim();properties[last]=predicate.substring(0,predicate.length-1);multi=true;}else{properties[last]=predicate;}}});return properties;}});;if(!Midas)var Midas={};Midas.Smarty=new Class({macroRegistry:{},template_directory:'',environment:{},internal:{},properties:{},blocks:[],config:{},debug:false,caching:true,runtimeCache:{},database:null,initialize:function(options){if(!options)options={};if(options.template_directory)this.template_directory=options.template_directory;this.macroRegistry['rdelim']=function(panelName,attributes,smartyInstance,block){return'}'};this.macroRegistry['ldelim']=function(panelName,attributes,smartyInstance,block){return'{'};this.macroRegistry['foreach']=function(panelName,attributes,smartyInstance,block){return Midas.SmartyLib.forMacro(block.tag,smartyInstance,block)};this.macroRegistry['assign']=function(panelName,attributes,smartyInstance,block){var value=Midas.SmartyLib.evaluateSmartyPHPHybridExpression(attributes['value'],smartyInstance);smartyInstance.set(attributes['var'],value);};this.macroRegistry['if']=function(panelName,attributes,smartyInstance,block){return Midas.SmartyLib.ifMacro(block.tag,block.attrs,smartyInstance,block)};this.macroRegistry['/if']=function(panelName,attributes,smartyInstance,block){return'';};this.macroRegistry['/foreach']=function(panelName,attributes,smartyInstance,block){return'';};this.macroRegistry['']=function(panelName,attributes,smartyInstance,block){return'';};this.macroRegistry['value']=function(panelName,attributes,smartyInstance,block){var value=Midas.SmartyLib.evaluateSmartyPHPHybridExpression(block.content,smartyInstance);return value;};},seekVariable:function(accessor,rootNode,value){var name=accessor.trim();if(name.substr(0,9)=='$smarty.')name=name.substr(8);if(name.substr(0,8)=='smarty.')name=name.substr(7);if(name.substr(0,1)=='$')name=name.substr(1);var keys=name.split('.');keys=keys.reverse();var nextIndex=keys.pop();if(rootNode[nextIndex]==undefined&&keys.length>0)rootNode[nextIndex]={};var current=rootNode[nextIndex];var expression='rootNode[\''+nextIndex+'\']';var accessor='rootNode.'+nextIndex;while(keys.length>0){nextIndex=keys.pop();expression+='[\''+nextIndex+'\']';if(isNaN(parseFloat(nextIndex)))accessor+='.'+nextIndex;else accessor+='['+nextIndex+']';var res=false;try{eval('if(!'+accessor+'){ res = true;}');}catch(error){}if(res&&keys.length>0){eval(accessor+' = {};')}}
if((value||value===0)&&value!=undefined){if(this.debug)Midas.SmartyLib.output(expression+' <= '+value);eval(expression+' = value;');}else{var value=eval(expression);if(this.debug)Midas.SmartyLib.output(expression+' => '+value);if(value)return value;}},getTemplateVars:function(name){return this.get_template_vars(name);},get_template_vars:function(name){return this.get(name);},assign:function(name,value){return this.set(name,value);},set:function(name,value){var val=this.seekVariable(name,this.environment,value);},get:function(name){try{var val=this.seekVariable(name,this.environment);if(val!=undefined)return val;else return'';}catch(exception){return'';}},getConfig:function(name){return this.seekVariable(name,this.config);},setConfig:function(name,value){return this.seekVariable(name,this.config,value);},getProperty:function(name){},output:function(value){return Midas.SmartyLib.output(value);},macro:function(name,attrs,block){if(!attrs.get)attrs.get=function(tagName){var value=null;this.each(function(item,index){if(item.name==tagName)value=item.value;}.bind(this));return value;}
if(this.macroRegistry[name])return this.macroRegistry[name](attrs.get('name'),attrs,this,block);else return'<!-- '+name+' [Macro not found!] -->';},getTemplate:function(name,callback,immediate){if(!immediate)immediate=false;if(this.runtimeCache[name]){callback(this.runtimeCache[name]);return this.runtimeCache[name];}
var value='';if(false){this.database.execute('SELECT * FROM templates where name = ?',{values:[name],onComplete:function(resultSet){this.output('return');while(row=resultSet.next()){this.output('result');}}.bind(this),onError:function(err){this.output(err.message);this.database.execute('CREATE TABLE IF NOT EXISTS templates (name TEXT NOT NULL PRIMARY KEY, template TEXT NOT NULL)',{values:[name],onComplete:function(resultSet){this.output('created');}});}.bind(this)});}
if(value==''){var ob=this;var templateRequest=new Request({url:name,method:'get',async:immediate,noCache:true,onSuccess:function(responseText,responseXML){value=this.response.text;ob.runtimeCache[name]=responseText;if(callback)callback(responseText);}}).send();}
this.value=value;if(false){this.database.execute('INSERT INTO templates (name, template) values(?, ?)',{values:[name,this.value],onComplete:function(resultSet){this.output('insert');}});}
return this.value;},parseMacro:function(macroText){var intext=false
var textMarker='';var result={name:'',attrs:[]}
var text='';var name='';invalue=false;first_tag=true;if(macroText.trim().startsWith('$')){result={name:'value',attrs:[]};}else{for(var lcv=0;lcv<macroText.length;lcv++){ch=macroText.charAt(lcv);if(!first_tag){if(intext){if(ch===textMarker){result.attrs.push({name:name.trim(),value:text});text='';intext=false;}else{text+=ch;}}else{switch(ch){case'\'':case'"':if(!intext){intext=true;textMarker=ch;}
break;case' ':if(text!=''){result.attrs.push({name:name.trim(),value:text});text='';}
break;case'=':name=text;text='';break;default:text+=ch;}}}else{if((ch===' '||macroText.length-1==lcv)&&text.trim()!=''){first_tag=false;if(ch!==' ')text+=ch;result.name=text;text='';}else{if(ch.trim()!='')text+=ch;}}}
result.attrs[name]=text;}
if(text!=''){result.attrs.push({name:name,value:text});text='';}
return result;},nestBlocks:function(results,stack){if(!results)return;if(stack==undefined)stack=[];var tag,last,blocks;results.copy().each(function(item,index){last=stack.getLast();tag=(last)?last.tag.name:undefined;blocks=(last)?last.blocks:results;if(!item.blocks)item.blocks=[];if(item.tag&&this.blockTags.contains(item.tag.name)){stack.push(item);}
if(tag&&item.tag&&'/'+tag==item.tag.name){this.nestBlocks(blocks.blocks,stack);stack.pop();blocks=(stack.getLast())?stack.getLast().blocks:results;}
if(!blocks.contains(item)){blocks.push(item)
results.erase(item);}}.bind(this));},fetch:function(templateName,callback,immediate){if(!immediate)immediate=false;var buffer='';this.getTemplate(this.template_directory+templateName,function(template){var results=this.scan(template);results.each(function(item,index){switch(item.blockType){case'tag':item.tag=this.parseMacro(item.content);break;}}.bind(this));this.nestBlocks(results);this.renderOutput(results);if(this.debug)this.output('['+templateName+']');buffer=Midas.SmartyLib.executeBlocks(results,this);if(callback)callback(buffer+'');}.bind(this),immediate);return buffer+'';},blockStack:[],blockTags:['if','foreach'],parseTags:function(block_list){block_list.each(function(item,index){switch(item.blockType){case'tag':item.tag=this.parseMacro(item.content);break;}}.bind(this));},renderOutput:function(block_list){block_list.each(function(item,index){switch(item.blockType){case'tag':if(item.tag.name=='value'){item.output=Midas.SmartyLib.evaluateSmartyPHPHybridExpression(item.content,this);}
if(item.blocks&&item.blocks.length>0){this.renderOutput(item.blocks);}
break;case'text':item.output=item.content;break;case'comment':if(this.debug)item.output='<!--[MSC] '+item.content+'-->';break;default:item.output=item.content;break;}}.bind(this));},scan:function(template){var parts=[];var ch;var intag=false;var incomment=false;var instring=false;var stringtype="'";var inliteral=false;parts[0]={blockType:'text',content:''};for(var lcv=0;lcv<template.length;lcv++){ch=template.charAt(lcv);if(instring){if(ch==stringtype&&template.chatAt(lcv-1)!='\\'){instring=false;}
parts[parts.length-1].content+=ch;}else if(inliteral){if(ch=='{'&&template.substring(lcv,lcv+10).toLowerCase()=='{/literal}'){lcv+=9;parts[parts.length]={blockType:'text',content:''};inliteral=false;}else{parts[parts.length-1].content+=ch;}}else if(intag){if(incomment){if(ch=='*'){var count=0
while(template.charAt(lcv+count+1)==' ')count++;if(template.charAt(lcv+count+1)=='}'){parts[parts.length]={blockType:'text',content:''};lcv+=count+1
intag=false;incomment=false;}else{parts[parts.length-1].content+=ch;}}else{parts[parts.length-1].content+=ch;}}else{if(ch=='}'){parts[parts.length]={blockType:'text',content:''};intag=false;}else{parts[parts.length-1].content+=ch;}}}else{if(ch=='{'){if(template.substring(lcv,lcv+9).toLowerCase()=='{literal}'){lcv+=8;parts[parts.length]={blockType:'literal',content:''};inliteral=true;}else{if(template.charAt(lcv+1)=='*'){parts[parts.length]={blockType:'comment',content:''};lcv++;intag=true;incomment=true;}else{parts[parts.length]={blockType:'tag',content:''};intag=true;}}}else{parts[parts.length-1].content+=ch;}}}
return parts;}});Midas.SmartyLib={conditions:[],pad:function(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;},evaluateSmartyPHPHybridBooleanExpression:function(expression,smartyInstance){var pattern=new RegExp('[Ii][Ff] +(\$[A-Za-z][A-Za-z0-9.]*) *$','m');var parts=expression.match(pattern);if(parts&&parts.length>0){return Midas.SmartyLib.evaluateSmartyPHPHybridVariable(parts[1].trim(),smartyInstance);}
pattern=new RegExp('[Ii][Ff](.*)(eq|ne|gt|lt|ge|le|==|>=|<=|<|>)(.*)','m');parts=expression.match(pattern);if(parts&&parts.length>3){var varOne=Midas.SmartyLib.evaluateSmartyPHPHybridVariable(parts[1].trim(),smartyInstance);var varTwo=Midas.SmartyLib.evaluateSmartyPHPHybridVariable(parts[3].trim(),smartyInstance);var res;switch(parts[2]){case'==':case'eq':res=(varOne==varTwo);break;case'!=':case'ne':res=(varOne!=varTwo);break;}
return res;}},evaluateSmartyPHPHybridExpression:function(variableName,smartyInstance){if(variableName===undefined)return null;var methods=variableName.splitHonoringQuotes('|',['#']);methods.reverse();var accessor=methods.pop();var value=Midas.SmartyLib.evaluateSmartyPHPHybridVariable(accessor,smartyInstance);var method;var params;var old=value;methods.each(function(item,index){params=item.split(':');params.reverse();method=params.pop();if(method=='default'){if(!value||value=='')value=Midas.SmartyLib.evaluateSmartyPHPHybridVariable(params[0],smartyInstance);}else{value=Midas.SmartyLib.executeMethod(method,value,params);}});return value;},evaluateSmartyPHPHybridVariable:function(accessor,smartyInstance,isConf){if(isConf==undefined||isConf==null)isConf=false;if(!accessor)return'';if(accessor.toLowerCase().startsWith('\'')&&accessor.toLowerCase().endsWith('\''))return accessor.substr(1,accessor.length-2);if(accessor.toLowerCase().startsWith('"')&&accessor.toLowerCase().endsWith('"'))return accessor.substr(1,accessor.length-2);if(accessor.toLowerCase().startsWith('$smarty.'))return smartyInstance.get(accessor.substr(8));if(accessor.startsWith('$')){var acc=accessor.substring(1);return smartyInstance.get(acc);}
if(accessor.startsWith('#')&&accessor.endsWith('#')){var cnf=accessor.substr(1,accessor.length-2);return Midas.SmartyLib.evaluateSmartyPHPHybridVariable(cnf,smartyInstance,true);}
return smartyInstance.get(accessor);var parts=accessor.split('.');parts.reverse();var currentPart=parts.pop();var currentValue;if(isConf){return smartyInstance.getConf(accessor);currentValue=smartyInstance.config[currentPart];}else switch(currentPart){case'smarty':currentValue=smartyInstance.internal;break;default:currentValue=smartyInstance.get(currentPart);if(currentValue==undefined)currentValue='';}
parts.each(function(item,index){if(!currentValue)return;if(currentValue[item]==undefined){currentValue=null;}else{currentValue=currentValue[item];}});return currentValue;},executeMethod:function(name,value,params){switch(name){case'default':if(value==null||value==''){var p=params.pop();return p;}else{return value;}
break;default:}},conditionalBranch:function(conditional,truebranch,falsebranch){if(!conditions[conditional]){conditions[conditional]=convertConditionToJS(conditional);}
eval('var result = '+conditions[conditional]+';');if(result){eval(truebranch);}else{eval(falsebranch);}},convertConditionToJS:function(conditional){},ifMacro:function(panelName,attributes,smartyInstance,block){var result=Midas.SmartyLib.evaluateSmartyPHPHybridBooleanExpression(block.content,smartyInstance);var hitElse=false;var item;if(block.ifBlocks)block.ifBlocks.empty();if(block.elseBlocks)block.elseBlocks.empty();for(index in block.blocks){item=block.blocks[index];if(item.blockType=='tag'&&item.content.trim()=='else'){hitElse=true;}else if(hitElse){if(!block.elseBlocks)block.elseBlocks=[];block.elseBlocks.push(item);}else{if(!block.ifBlocks)block.ifBlocks=[];block.ifBlocks.push(item);}}
var buffer='';if(result)buffer=Midas.SmartyLib.executeBlocks(block.ifBlocks,smartyInstance);else buffer=Midas.SmartyLib.executeBlocks(block.elseBlocks,smartyInstance);if(buffer==undefined)return'';return buffer;},generateUUID:function(){var s=[];var hexDigits="0123456789ABCDEF";for(var i=0;i<32;i++)s[i]=hexDigits.substr(Math.floor(Math.random()*0x10),1);s[12]="4";s[16]=hexDigits.substr((s[16]&0x3)|0x8,1);var uuid=s.join("");return uuid;},executeBlocks:function(blocks,smartyInstance){var buffer='';var out={};var count=1;if(!blocks||typeof(blocks)!='object'){if(smartyInstance.debug)smartyInstance.output('No blocks to execute!');return;}
blocks.each(function(item,index){if(item.tag){buffer+=smartyInstance.macro(item.tag.name,item.tag.attrs,item);}else if(item.output){buffer+=item.output;}}.bind(this));return buffer;},forMacro:function(tag,smartyInstance,block){var requiredAttrs=['from','key'];var buffer='';if(this.requireAttrs(tag,requiredAttrs,smartyInstance)){var name;var indexName;if(tag.attrs.name){name=this.getAttr('name',tag.attrs);indexName='foreach.'+name+'.index';}else{name='A'+this.generateUUID();indexName='foreach.'+name+'.index';}
var from=this.getAttr('from',tag.attrs);var to=this.getAttr('to',tag.attrs);var keyName=this.getAttr('key',tag.attrs);var itemName=this.getAttr('item',tag.attrs);var collection=Midas.SmartyLib.evaluateSmartyPHPHybridVariable(from,smartyInstance);var collection_length=0;var keys=[];for(index in collection){collection_length++;keys.push(index);}
var count=0;if(collection_length>0){var indexName='foreach.'+name+'.index';if(typeof(collection)=='string'&&collection==''){return buffer;}
var originalIndex=smartyInstance.get(indexName);var originalKey=smartyInstance.set(keyName);var originalItem=smartyInstance.set(itemName);if(collection.each){collection.each(function(item,index){smartyInstance.set(indexName,count++);smartyInstance.set(keyName,index);smartyInstance.set(itemName,item);buffer+=Midas.SmartyLib.executeBlocks(this.blocks,smartyInstance);}.bind(block));}else{var item;for(var index in collection){item=collection[index];smartyInstance.set(indexName,count);smartyInstance.set(keyName,index);smartyInstance.set(itemName,item);buffer+=Midas.SmartyLib.executeBlocks(block.blocks,smartyInstance);}}
smartyInstance.set(indexName,null);smartyInstance.set(keyName,null);smartyInstance.set(itemName,null);}else{smartyInstance.output('ERROR: empty collection('+from+')!');smartyInstance.output(collection);smartyInstance.output('environment:');smartyInstance.output(smartyInstance.environment);}}else{smartyInstance.output('missing a required attr! '+requiredAttrs);smartyInstance.output(tag.attrs);}
return buffer;},requireAttrs:function(tag,attrs,smarty){var returnVal=true;var foundOne;var out;attrs.each(function(attr,aIndex){foundOne=false;out='';tag.attrs.each(function(tagAttr,taIndex){if(attr==tagAttr.name){foundOne=true;}});returnVal=returnVal&&foundOne;});return returnVal;},getAttr:function(tag,attrs){var returnVal=null;attrs.each(function(attr,aIndex){if(tag==attr.name)returnVal=attr.value;});return returnVal;},output:function(value){if(console){if(navigator.userAgent.toLowerCase().indexOf("applewebkit")!=-1){}else{}}},getValue:function(expression){var parts=explode('|',expression);var value=parts[0].substring(1);for(var lcv=1;lcv<parts.length;lcv++){eval('value = '+parts[lcv]+'(value);');}
return value;}};if(!Array.copy){Array.implement({copy:function(){var result=[];this.each(function(item){result.push(item);}.bind(this));return result;}});}
if(!String.startsWith){String.implement({startsWith:function(text){return this.indexOf(text)==0;}});}
if(!String.endsWith){String.implement({endsWith:function(text){return this.substr(text.length*-1)===text;}});}
if(!String.reverse){String.implement({reverse:function(){splitext=this.split("");revertext=splitext.reverse();reversed=revertext.join("");return reversed;}});}
if(!String.splitHonoringQuotes){String.implement({splitHonoringQuotes:function(delimiter,quotes){if(quotes==undefined)quotes=['\'','"'];var results=[''];var inQuote=false;var quote=null;for(var lcv=0;lcv<this.length;lcv++){if(inQuote){if(this[lcv]==quote){inQuote=false;}else{results[results.length-1]+=this[lcv];}}else{if(quotes.contains(this[lcv])){quote=this[lcv];inQuote=true;}else if(this[lcv]==delimiter){results[results.length]='';}else{results[results.length-1]+=this[lcv];}}}
return results;}});}
var XHTMLParser=new Class({Extends:Midas.SAXParser,stack:[],root:null,scripts:[],open:function(name,attrs){var node;if(name.indexOf(':')!=-1){var attributes='';for(key in attrs){attributes+=key+'="'+attrs[key]+'" ';}
node=new Element('div');node.innerHTML='<'+name+' '+attributes+'></'+name+'>';node=node.children[0];}else{node=new Element(name,attrs);}
if(this.stack.length>0)this.stack.getLast().appendChild(node);this.stack.push(node);},content:function(text){if(this.stack.length>0)this.stack.getLast().appendText(text);},close:function(name){this.root=this.stack.pop();if(name.toLowerCase()=='script')this.scripts.push();},parse:function(html){var exp=new RegExp('(<script\\b[^>]*>)([\\s\\S]*?)(<\\/script>)','igm');html=html.replace(exp,'$1/*<![CDATA[*//*---->*/$2/*--*//*]]>*/$3');this.parent(html);return this.root;}});if(!String.toDOM){String.implement({toDOM:function(mode){if(!mode)mode='sax';var result=false;switch(mode){case'sax':var pageParser=new XHTMLParser();return pageParser.parse(this);break;case'iframe':var myIFrame=new IFrame({src:'about:blank',id:'dummy_iframe',});myIFrame.inject(document.body);myIFrame.set('html',this);result=myIFrame.clone();myIFrame.destroy();break;case'div':var injector=new Element('div',{'html':this,'styles':{'position':'absolute','left':-1000000}}).inject(document.body);result=injector.getChildren();injector.destroy();break;}
return result;}});}
if(!NodeList.prototype.each){NodeList.prototype.each=function(callback){for(index in this){callback(this[index],index);}}}
if(!Element.diff){Element.implement({diff:function(node){this.childNodes.each(function(child,index){});}});}
if(!Element.sameAs){Element.implement({sameAs:function(node,recursive){different=false;if(this.nodeName!=node.nodeName)different=true;this.attributes.each(function(value,name){if(node[name]!=value)different=true;});if(recursive){if(this.childNodes.length!=node.childNodes.length)different=true;else this.childNodes.each(function(child,index){if(!child.sameAs(node.childNodes[index]))different=true;});}
return!different;}});}